CREATE DATABASE IF NOT EXISTS library;

USE library;

DROP TABLE IF EXISTS loans;
DROP TABLE IF EXISTS users;
DROP TABLE IF EXISTS titles;

CREATE TABLE titles(
isbn				VARCHAR(13)             NOT NULL,
name				VARCHAR(60)		NOT NULL,
location			VARCHAR(10)		NOT NULL,
total_stock			INT			NOT NULL DEFAULT 0,
quantity_on_loan                INT			NOT NULL DEFAULT 0,
loan_period			TINYINT(2)		NOT NULL DEFAULT 14,
authors                         VARCHAR(100)            NOT NULL,
PRIMARY KEY (isbn),
UNIQUE (name),
INDEX (location)
)
ENGINE=INNODB DEFAULT CHARSET=latin1;


-- Although email is unique for each user, we still need the id field.
-- The reason is in relation to performance & the loan table. If we use the email field
-- to associate both tables, we will essentially be adding 100 bytes to each and every loan transaction.
-- This is inefficient in terms of storage space, memory usage & performance. Using the id field means
-- that only 4 bytes need be stored or read.
CREATE TABLE users(
id				INT                     NOT NULL	AUTO_INCREMENT,
name				VARCHAR(40)		NOT NULL,
email				VARCHAR(100)            NOT NULL,
password			VARCHAR(10)		NOT NULL,
isadmin				BOOLEAN                 NOT NULL        DEFAULT FALSE,
PRIMARY KEY (id),
UNIQUE (email)
)
ENGINE=INNODB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1;


-- Note - cannot make isbn & user_id primary as this would allow a user to only take a title out once.
-- And as unlikely as it seems, it is in the realms of human possibility/madness to take a loan out, return it and take it out again on the same day.
CREATE TABLE loans(
id				INT                     NOT NULL	AUTO_INCREMENT,
user_id				INT			NOT NULL,
isbn				VARCHAR(13)             NOT NULL,
date_borrowed                   DATE			NOT NULL,
date_due			DATE			NOT NULL,
date_returned                   DATE			NULL,
PRIMARY KEY (id),
INDEX (user_id),    -- Improve search performance
INDEX (isbn),       -- Improve search performance
-- Users Id in the User table is generated by the DBMS and so we are not going to allow any changes to it anywhere.
CONSTRAINT fk_loanuser FOREIGN KEY (user_id) REFERENCES users (id) ON UPDATE RESTRICT ON DELETE RESTRICT,
-- ISBN's in the Title table are entered by the user, and as such, mistakes can happen during this, so we will allow
-- changes to it and allow these changes to cascade down into child tables.
CONSTRAINT fk_loantitle FOREIGN KEY (isbn) REFERENCES titles (isbn) ON UPDATE CASCADE ON DELETE RESTRICT
)
ENGINE=INNODB DEFAULT CHARSET=latin1 AUTO_INCREMENT=1;

INSERT INTO users (name,email,password,isadmin) VALUES ("Paul Millar", "pm@gmail.com","password",1);
INSERT INTO users (name,email,password,isadmin) VALUES ("Ehi Omorede", "eh@gmail.com","password",1);
INSERT INTO users (name,email,password,isadmin) VALUES ("Declan Smyth", "ds@hotmail.com","password",0);
INSERT INTO users (name,email,password,isadmin) VALUES ("Bryan Holland", "bh@yahoo.com","password",0);
INSERT INTO users (name,email,password,isadmin) VALUES ("Amy Whitmarsh", "aw@hotmail.com","password",0);
INSERT INTO users (name,email,password,isadmin) VALUES ("Marie Brennan", "mb@hotmail.com","password",0);
INSERT INTO users (name,email,password,isadmin) VALUES ("Linda Doherty", "ld@yahoo.com","password",0);
INSERT INTO users (name,email,password,isadmin) VALUES ("Pauline mcglynn", "pmcg@gmail.com","password",0);
INSERT INTO users (name,email,password,isadmin) VALUES ("Helga Gartland", "hg@yahoo.com","password",0);
INSERT INTO users (name,email,password,isadmin) VALUES ("Phillip Whitmore", "pw@yahoo.com","password",0);


INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,authors) VALUES ("9781416591061","Empire of the Summer Moon","A23",2,1,"S.C. Wynne");					
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,authors) VALUES ("25678", "Chickenhawk","A24",1,0,"Robert Mason");											
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,authors) VALUES ("1111", "MS SQL MCTS EXAM 70-432 Implementation & Maintenance","B31",2,1,"Mike Hotek");	
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,authors) VALUES ("2222", "MS SQL MCTS EXAM 70-433 Database Development","D42",3,3,"Tobias Thernstrom,Ann Weber,Mike Hotek");			
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,authors) VALUES ("3333", "MS .NET MCTS EXAM 70-536 Application Development","D42",3,2,"Tony Northrup");		
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,authors) VALUES ("4444", "MS .NET MCTS EXAM 70-561 ADO.NET Development","E21",2,2,"Mark Blomasa, Shawn Wildermuth, Jim Wightman");			
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,authors) VALUES ("5555", "MS .NET MCTS EXAM 70-562 ASP.NET Development","E22",4,4,"Mike Snell,Glenn Johnson,Tony Northrup");					
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,authors) VALUES ("6666", "MS .NET MCTS EXAM 70-505 Windows Forms Development","E22",1,1,"Matthew A. Stoecker,Steven J. Stein,Mike Hotek");	
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,loan_period,authors) VALUES ("7777", "Programming Entity Framework - Code First","E21",1,1,21,"Julia Lerman,Rowan Miller");	
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,loan_period,authors) VALUES ("8888", "Programming Entity Framework - DbContext","H36",2,2,21,"Julia Lerman,Rowan Miller");	
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,loan_period,authors) VALUES ("9999", "HTML Programming for ASP.NET Developers","H37",2,1,21,"Bipin Joshi");	
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,loan_period,authors) VALUES ("9898", "ASP.NET & MVC2 with Visual Studio 2010","E22",2,1,21,"Dino Esposito");	
INSERT INTO titles (isbn,name,location,total_stock,quantity_on_loan,loan_period,authors) VALUES ("3232", "Beginning PHP 5.3","E22",2,1,21,"Matt Doyle");



INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (1,"9781416591061","2013-01-31","2013-02-14","2013-02-10");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (3,"1111","2013-05-28","2013-06-11","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (2,"1111","2013-07-01","2013-07-14","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (7,"1111","2013-09-08","2013-09-23","2013-09-22");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (4,"2222","2013-05-28","2013-06-11","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (8,"2222","2013-07-01","2013-07-14","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (10,"2222","2013-09-08","2013-09-23","2013-09-22");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (5,"3333","2013-05-28","2013-06-11","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (6,"3333","2013-07-01","2013-07-14","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (7,"3333","2013-09-08","2013-09-23","2013-09-22");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (9,"4444","2013-05-28","2013-06-11","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (4,"4444","2013-07-01","2013-07-14","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (5,"4444","2013-09-08","2013-09-23","2013-09-22");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (10,"5555","2013-05-28","2013-06-11","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (3,"5555","2013-07-01","2013-07-14","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (4,"5555","2013-09-08","2013-09-23","2013-09-22");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (8,"6666","2013-05-28","2013-06-11","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (7,"6666","2013-07-01","2013-07-14","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (6,"6666","2013-09-08","2013-09-23","2013-09-22");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (7,"7777","2013-05-28","2013-06-18","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (9,"7777","2013-07-01","2013-07-22","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (2,"7777","2013-09-08","2013-09-29","2013-09-22");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (6,"8888","2013-05-28","2013-06-18","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (10,"8888","2013-07-01","2013-07-22","2013-02-07 ");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (8,"8888","2013-09-08","2013-09-29","2013-09-22");

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (2,"9999","2013-05-28","2013-06-18","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (5,"9999","2013-07-01","2013-07-22","2013-02-07");
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (1,"9999","2013-09-08","2013-09-29","2013-09-22");


INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (2,"9781416591061","2013-10-15","2013-10-29",NULL);


INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (3,"1111","2013-10-02","2013-10-16",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (3,"2222","2013-10-02","2013-10-16",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (3,"5555","2013-10-30","2013-11-13",NULL);

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (4,"3333","2013-10-03","2013-10-17",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (4,"5555","2013-10-03","2013-10-17",NULL);

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (5,"7777","2013-10-08","2013-10-29",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (5,"3232","2013-10-17","2013-11-07",NULL);

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (6,"8888","2013-10-08","2013-10-29",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (6,"3333","2013-10-18","2013-11-01",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (6,"9999","2013-10-21","2013-11-11",NULL);

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (7,"8888","2013-10-03","2013-10-24",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (7,"9898","2013-10-13","2013-11-03",NULL);

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (1,"4444","2013-10-04","2013-10-18",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (8,"6666","2013-10-26","2013-11-09",NULL);

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (8,"4444","2013-10-17","2013-10-31",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (9,"5555","2013-10-22","2013-11-05",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (9,"2222","2013-10-26","2013-11-09",NULL);

INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (10,"5555","2013-10-07","2013-10-21",NULL);
INSERT INTO loans (user_id,isbn,date_borrowed,date_due,date_returned) VALUES (10,"2222","2013-10-26","2013-11-09",NULL);
